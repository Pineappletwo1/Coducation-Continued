ko.bindingHandlers.featureTrack = {
    init: function(element, valueAccessor, allBindingsAccessor) {
        let dataToTrack = valueAccessor();
        let trackerUrl = allBindingsAccessor.get("url");

        const inputType = getInputType(element);
        switch (inputType) {
            case "text":
                trackOnEnterKey();
                break;
            case "select":
                trackOnChange();
                break;
            default:
                trackOnClick();
        }

        function getInputType(element) {
            return element.tagName.toString().toLowerCase() === "input" ?
                $(element).prop("type").toLowerCase() :
                element.tagName.toLowerCase();
        }

        function trackOnEnterKey() {
            const INTRO = 13;
            $(element).keypress((evt) => {
                if (evt.which == INTRO) {
                    track();
                }
            });
        }

        function trackOnChange() {
            $(element).change(track);
        }

        function trackOnClick() {
            $(element).click(track);
        }

        function track() {
            $.ajax({
                type: 'POST',
                url: trackerUrl,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(dataToTrack),
                async: false
            });
        }
    }
};