ko.bindingHandlers.imageWithPreload = {
    init: (element, valueAccessor) => {
        const parameters = valueAccessor();
        const url = parameters.url;
        const imgCss = parameters.imgCss;
        const spinnerCss = parameters.spinnerCss || "fa fa-refresh fa-spin fa-2x text-center";

        $(element).addClass('text-center');

        const spinner = createSpinner(spinnerCss);
        const img = createImg(imgCss);

        img.load(() => spinner.hide());

        function createSpinner(spinnerCss) {
            const spinner = $('<i></i>');
            spinner.addClass(spinnerCss);
            spinner.css('margin-top', '10%');
            spinner.css('margin-bottom', '10%');
            $(element).append(spinner);
            return spinner;
        }

        function createImg(imgCss) {
            const imgElement = $('<img>');
            $(element).append(imgElement);
            imgElement.attr('src', url);
            imgElement.addClass(imgCss);
            return imgElement;
        }
    }
};