ko.bindingHandlers.aidadaterangepicker = {
    update: function(element, valueAccessor, allBindings) {
        const startDate = valueAccessor();
        const endDate =  allBindings.get("endDate");
        const minDate =  allBindings.get("minDate") || moment();
        const formatPattern = allBindings.get("formatPattern");        
        const applyLabel = allBindings.get("applyLabel") || "Apply";
        const cancelLabel = allBindings.get("cancelLabel") || "Cancel";        
        let sDate = moment(startDate());
        let eDate = moment(endDate());

        $(element).daterangepicker({
            timePicker: true,
            timePicker24Hour: true,
            timePickerIncrement: 15,
            locale: { 
                format: formatPattern,
                applyLabel: applyLabel,
                cancelLabel: cancelLabel
            },
            startDate: sDate,
            endDate: eDate,
            buttonClasses: "btn",
            applyClass: "btn-primary",
            minDate: minDate
        });
        
        $(element).on('apply.daterangepicker', function(ev, picker) {
            startDate(toISO8601Format(picker.startDate));
            endDate(toISO8601Format(picker.endDate));
        });
        
        function toISO8601Format(date) {
            if (!date) return null;
            return moment(date, 'L').toISOString();
        }
    }
};